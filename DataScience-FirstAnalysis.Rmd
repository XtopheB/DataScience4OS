---
title: "A step-by-step Analysis- Descriptive"
subtitle: "NSB course - Thimphu"
author: "Christophe Bontemps"
date:   "`r Sys.Date()`"
output:
  html_document: 
    df_print: paged
    always_allow_html: true
    toc: yes
    toc_float: true
    keep_md: no
    code_folding: show
    code_download: true
  word_document: default
  pdf_document: default
---


```{r setup, include=FALSE}
library(tidyverse)
# All graphics will have this theme
theme_set(theme_minimal())
# We'll see why this is important later
set.seed(123)
```

## Motivation

Descriptive statistics are essential in official statistics.  
However, they are often insufficient to understand **relationships** between variables.

They are essential, but:
  - They hide heterogeneity
  - They cannot isolate multiple effects
  - They may lead to misleading policy conclusions

We illustrate this Here

---

## A simple official statistics question

**Question:**  
How does household income vary with years of education?

**Variables:**
- Household income (continuous)
- Years of education of household head (continuous)
- Age of household head (continuous)

---


# Data

## Data-generating process (unknown to the analyst)

```{r include=FALSE}
n <- 600

data <- tibble(
  sex = sample(c("Men", "Women"), n, replace = TRUE),
  education_level = sample(
    c("None", "Secondary", "Tertiary"),
    n, replace = TRUE,
    prob = c(0.3, 0.4, 0.3)
  )
) %>%
  mutate(
    education = case_when(
      education_level == "None" ~ round(rnorm(n(), 5, 1)),
      education_level == "Secondary" ~ round(rnorm(n(), 10, 1)),
      education_level == "Tertiary" ~ round(rnorm(n(), 16, 1))
    ),
    age = round(rnorm(n(), mean = 40, sd = 10)),
    
    base_income = 300,
    education_effect = 20 * education,
    sex_education_bonus = if_else(
      sex == "Women" & education > 14,
      150,
      0
    ),
    income = base_income +
      education_effect +
      sex_education_bonus +
      rnorm(n(), 0, 60)
  )

# Data Simulation cleaning


data1 <- data %>%
  select(income, age,  education, education_level, sex) 


```

# Descriptive statistics

## Average income by sex

```{r}
data %>%
  group_by(sex) %>%
  summarise(mean_income = mean(income), .groups = "drop") %>%
  ggplot(aes(sex, mean_income, fill = sex)) +
  geom_col() +
  labs(
    title = "Average income by sex",
    y = "Mean income",
    x = NULL
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

**Tempting interpretation:**  
> Men earn more than women.

# Adding a continuous variable

## Scatter plot: income vs years of education

```{r}
ggplot(data, aes(education, income)) +
  geom_point(alpha = 0.5) +
  labs(
    title = "Income and years of education",
    x = "Years of education",
    y = "Income"
  ) +
  theme_minimal()
```

This suggests a positive relationship, but variability is large.

# Adding more information

## Income, education and age

```{r}
ggplot(data, aes(education, income, color = age)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Income, education and age",
    x = "Years of education",
    y = "Income",
    color = "Age"
  ) +
  theme_minimal()
```

The relationship is still hard to interpret clearly.

# Introducing heterogeneity

## Income–education relationship by sex

```{r}
ggplot(data, aes(education, income, color = sex)) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Income–education relationship by sex",
    x = "Years of education",
    y = "Income",
    color = "Sex"
  ) +
  theme_minimal()
```

We now see:

- Education increases income for both sexes
- The effect is **stronger for women**
- This was hidden in earlier descriptive statistics

# Limitation of descriptive statistics

## Why this is still not enough

- Visual inspection is subjective
- Effects are hard to quantify
- Multiple variables are difficult to handle simultaneously

This motivates regression.

# Regression model

## Linear model with interaction

```{r, echo=TRUE}
model <- lm(income ~ education * sex + age, data = data)
summary(model)
```

This model:

- Quantifies the effect of education
- Controls for age
- Explicitly models different education effects by sex

# Key message

## Take-away for official statistics

- Descriptive statistics are indispensable
- But they are not sufficient for policy analysis
- Regression is a natural and necessary extension

**Descriptive statistics describe.  
Regression explains.**

